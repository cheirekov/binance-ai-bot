# Copy to `.env` and edit. Never commit real secrets.
NODE_ENV=development                         # dev/production toggle
PORT=8788                                    # Backend API port (Fastify)
FRONTEND_ORIGIN=http://localhost:4173        # CORS allow-list for the UI origin

# API rate limiting (enabled by default; keyed by `x-api-key` when present, else client IP)
API_RATE_LIMIT_MAX=120                       # Max requests per window
API_RATE_LIMIT_WINDOW_SECONDS=10             # Window size in seconds

# Binance API credentials (use restricted keys; enable IP restrictions!)
BINANCE_API_KEY=your_key
BINANCE_API_SECRET=your_secret
BINANCE_BASE_URL=https://api.binance.com     # Spot testnet: https://testnet.binance.vision

# Trading venue
TRADE_VENUE=spot                             # spot | futures (USD-M)
FUTURES_ENABLED=false                        # Required when TRADE_VENUE=futures (extra safety gate)
FUTURES_BASE_URL=https://fapi.binance.com    # USD-M Futures testnet: https://testnet.binancefuture.com
FUTURES_LEVERAGE=2                           # 1..125 (higher = higher liquidation risk)
FUTURES_MARGIN_TYPE=ISOLATED                 # ISOLATED | CROSSED

# Live orders: MUST be true to place real orders (used by both UI + auto-trader).
TRADING_ENABLED=false

# OpenAI API (optional; bot runs with heuristics if missing)
OPENAI_API_KEY=your_openai_api_key
OPENAI_MODEL=gpt-4.1-mini                    # Lower cost; upgrade for stronger reasoning
OPENAI_BASE_URL=                             # Optional: use an OpenAI-compatible endpoint (e.g. local Ollama/vLLM/llama.cpp)
AI_POLICY_MODE=off                           # off | advisory | gated-live (LLM proposes actions; engine validates/executes)
AI_POLICY_MODEL=gpt-4.1-mini                 # Model used for AI policy decisions (defaults to OPENAI_MODEL)
AI_POLICY_MIN_INTERVAL_SECONDS=300           # Minimum seconds between AI policy calls (token control)
AI_POLICY_MAX_CALLS_PER_DAY=200              # Daily cap for AI policy calls (token control)
AI_POLICY_MAX_CANDIDATES=8                   # Max candidate symbols to include in the prompt
AI_POLICY_MAX_GRID_ALLOC_INCREASE_PCT_PER_DAY=5 # AI tuning clamp: max +%/day for GRID_MAX_ALLOC_PCT (decreases always allowed)
AI_POLICY_TUNING_AUTO_APPLY=false            # If true: apply AI-proposed parameter tuning (bounded) automatically
AI_POLICY_SWEEP_AUTO_APPLY=false             # If true: allow AI to auto-trigger sweep-unused (spot-only)
AI_POLICY_SWEEP_COOLDOWN_MINUTES=180         # Min minutes between AI-triggered sweeps (token + churn control)

# Strategy defaults
SYMBOL=BTCUSDC                               # Default symbol used when UI doesn't specify `?symbol=`
QUOTE_ASSET=USDC                             # Preferred "home" quote asset (display + sizing baseline)
HOME_ASSET=USDC                              # Risk-off "home" currency (spot). For USD-M futures, this is typically USDT.

# Universe selection:
# - If `ALLOWED_SYMBOLS` is NON-empty: auto-select stays within it (safe).
# - If `ALLOWED_SYMBOLS` is empty: bot auto-discovers SPOT symbols whose quote asset is in `ALLOWED_QUOTES`.
ALLOWED_SYMBOLS=                             # e.g. BTCUSDC,ETHUSDC (leave blank for auto-discover)
ALLOWED_QUOTES=USDC,EUR                      # For futures (USD-M), include USDT (e.g. USDT,USDC)
AUTO_SELECT_SYMBOL=true                      # Scheduler picks best symbol periodically
AUTO_DISCOVER_SYMBOLS=true                   # Use Binance exchangeInfo to find tradable SPOT symbols
UNIVERSE_MAX_SYMBOLS=50                      # Candidate pool size (higher = broader scan, more CPU)

# Liquidity / volatility filters
MIN_QUOTE_VOLUME=5000000                     # 24h quote-volume floor in HOME_ASSET terms (converted for BTC/ETH/etc)
MAX_VOLATILITY_PCT=18                        # 24h high/low volatility cap (%)
BLACKLIST_SYMBOLS=                           # Comma list to hard-block specific symbols

# News sentiment (optional)
# Must be direct RSS/Atom XML endpoints (not HTML pages).
# Note: Binance Square/Announcements pages are HTML and may be protected by anti-bot challenges, so they usually won't work here.
NEWS_FEEDS=https://cointelegraph.com/rss,https://cryptoslate.com/feed/,https://decrypt.co/feed
NEWS_CACHE_MINUTES=15                        # Cache duration for feeds
NEWS_WEIGHT=2                                # Influence of sentiment in scoring

# Persistence
PERSISTENCE_PATH=/app/data/state.json        # Docker volume path for state (compose mounts `./data:/app/data`)
PERSIST_TO_SQLITE=false                      # Optional: also persist features/decisions/trades to SQLite (best-effort; never blocks trading)
SQLITE_PATH=/app/data/bot.sqlite             # Must live under /app/data to persist via Docker volume

# Auto-trading
AUTO_TRADE_ENABLED=false                     # True enables the scheduler to place orders automatically
AUTO_TRADE_HORIZON=short                     # Preferred horizon; bot may override if conditions differ
AUTO_TRADE_MIN_CONFIDENCE=55                 # Min confidence % to trade
AUTO_TRADE_COOLDOWN_MINUTES=90               # Cooldown per symbol/horizon (minutes)
DAILY_LOSS_CAP_PCT=3                         # Enables emergency-stop if equity drawdown exceeds this % (resets daily)
SLIPPAGE_BPS=8                               # Reduce size by this many bps to account for slippage
OCO_ENABLED=true                             # Place TP/SL OCO after entry (Binance must support OCO for symbol)

# Portfolio mode (optional; more automation)
PORTFOLIO_ENABLED=false                      # If true: manage multiple positions across top-ranked symbols
PORTFOLIO_MAX_ALLOC_PCT=50                   # Max % of HOME_ASSET to allocate (approx; based on tracked positions)
PORTFOLIO_MAX_POSITIONS=3                    # Max simultaneous open long positions
CONVERSION_ENABLED=false                     # Allow converting HOME_ASSET->needed quote (e.g., USDC->BTC) when required
RISK_OFF_SENTIMENT=-0.5                      # If news sentiment <= this, close positions + move back to HOME_ASSET

# Grid trading (spot-only; optional; mean-reversion / range trading)
# Grid places many LIMIT orders; it can lose money in trending markets and it locks balances while orders are open.
# Grid candidates are auto-discovered via heuristics (liquidity + "range-boundness"), not via OpenAI.
GRID_ENABLED=false                           # Enable spot grid trader (requires TRADE_VENUE=spot)
GRID_AUTO_DISCOVER=true                      # If true and GRID_SYMBOLS empty: auto-pick grid symbols (HOME_ASSET-quoted only)
GRID_SYMBOLS=                                # Optional manual list (e.g. BTCUSDC,ETHUSDC). Must be quote=HOME_ASSET.
GRID_MAX_ALLOC_PCT=25                        # Max % of free HOME_ASSET reserved for ALL grids combined
GRID_MAX_ACTIVE_GRIDS=1                      # Max number of simultaneous running grids
GRID_LEVELS=21                               # Number of grid levels (approx: levels-1 open orders)
GRID_KLINE_INTERVAL=1h                       # Kline interval used to derive auto-range
GRID_KLINE_LIMIT=120                         # Kline candle count used to derive auto-range
GRID_MIN_RANGE_PCT=3                         # Min derived range width (% of mid price)
GRID_MAX_RANGE_PCT=15                        # Max derived range width (% of mid price)
GRID_MAX_TREND_RATIO=0.35                    # Trendiness filter (smaller = more range-bound)
GRID_GAP_BPS=10                              # Do not place orders within this many bps of the current price
GRID_MIN_STEP_PCT=0.6                        # Minimum % spacing between adjacent levels (prevents over-tight grids)
GRID_REBALANCE_SECONDS=60                    # How often grids are synced (seconds)
GRID_MAX_NEW_ORDERS_PER_TICK=8               # Rate-limit for new orders per tick
GRID_BOOTSTRAP_BASE_PCT=50                   # Market-buy initial base inventory (% of grid allocation)
GRID_BREAKOUT_ACTION=cancel                  # none | cancel | cancel_and_liquidate (liquidate sells free base; use with care)
GRID_BREAKOUT_BUFFER_PCT=0.5                 # Extra buffer beyond range before breakout triggers
GRID_BUY_PAUSE_ON_LIQUIDITY_HALT=true        # If quote-volume < MIN_QUOTE_VOLUME: cancel open BUYs + pause new BUYs (SELLs stay)
LIQUIDITY_RESUME_TICKS=3                     # Resume BUYs after this many consecutive ticks above MIN_QUOTE_VOLUME
LIQUIDITY_RESUME_MINUTES=5                   # Also require this many minutes since pause before resuming BUYs

# Risk Governor (account-level regime protection; computed from live balances + tickers + state.json; NOT SQLite)
RISK_GOVERNOR_ENABLED=true                   # Master enable (safe default: true)
RISK_WINDOW_MINUTES=360                      # Rolling window for equity/fee burn buffers

# Drawdown thresholds based on mark-to-market equity (home terms)
RISK_DRAWDOWN_CAUTION_PCT=1.0                # Enter CAUTION: pause new entries
RISK_DRAWDOWN_HALT_PCT=2.0                   # Enter HALT: stop new entries + pause grid BUY legs

# Fee burn thresholds (best-effort; low sensitivity; may remain inactive if fee telemetry missing)
RISK_FEE_BURN_CAUTION_PCT=0.20               # Fee burn % of notional over window to enter CAUTION
RISK_FEE_BURN_HALT_PCT=0.40                  # Fee burn % of notional over window to enter HALT

# Trend hysteresis (used both by governor and Grid Guard)
RISK_TREND_ADX_ON=25                         # Trending regime "ON"
RISK_TREND_ADX_OFF=18                        # Trending regime "OFF" (hysteresis)

# Transition time gates (prevents thrashing/flapping)
RISK_MIN_STATE_SECONDS=300                   # Minimum seconds to remain in any state before de-escalation
RISK_HALT_MIN_SECONDS=600                    # Minimum seconds to remain in HALT before de-escalation

# Optional hard behavior (DANGEROUS; defaults are safe)
RISK_HALT_MARKET_EXIT=false                  # If true: allow market-exit inventory during HALT (default false)
RISK_HALT_CANCEL_ALL_ORDERS=false            # If true: cancel ALL open orders during HALT (default false)

# Grid Guard (per-symbol grid BUY pause/resume in bad regimes; SELLs stay active)
GRID_GUARD_ENABLED=true                      # Master enable (safe default: true)
GRID_BREAKDOWN_PCT=1.0                       # Falling-knife threshold: price < lowerBand * (1 - pct)
GRID_BREAKDOWN_TICKS=3                       # Require N consecutive breakdown ticks to pause buys
GRID_ATR_PCT_MAX=6.0                         # Optional vol spike threshold (ATR%); pauses buys
GRID_RESUME_TICKS=3                          # Require N consecutive "resume OK" ticks to resume buys
GRID_RESUME_MINUTES=5                        # Also require this many minutes since pause before resuming buys

# Risk sizing
MAX_POSITION_SIZE_USDT=200                   # Max notional used for sizing (USDT-equivalent)
RISK_PER_TRADE_BP=50                         # Basis points risked per trade (50=0.5%)
REFRESH_SECONDS=30                           # Strategy refresh interval

# API/UI auth
API_KEY=change_me                            # Backend requires `x-api-key: ...` on every request if set
CLIENT_KEY=change_me                         # Client key used by the browser UI to call the API
BASIC_AUTH_USER=bot                          # UI basic auth user (Docker web image build arg)
BASIC_AUTH_PASS=botpass                      # UI basic auth password (Docker web image build arg)

# Frontend
VITE_API_URL=http://localhost:8788           # API endpoint for frontend
VITE_CLIENT_KEY=change_me                    # Must match CLIENT_KEY (sent as `x-api-key`)
